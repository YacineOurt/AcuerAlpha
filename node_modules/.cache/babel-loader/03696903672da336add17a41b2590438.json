{"ast":null,"code":"var _objectSpread = require(\"/home/yacine/Pro/alpha/AcuerApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/objectSpread\");\n\nvar MapboxDraw = require('@mapbox/mapbox-gl-draw');\n\nvar Constants = require('../utils/constants');\n\nvar doubleClickZoom = require(\"../utils/double_click_zoom\");\n\nvar dragPan = require('../utils/drag_pan');\n\nvar circle = require('@turf/circle').default;\n\nvar distance = require('@turf/distance').default;\n\nvar turfHelpers = require('@turf/helpers');\n\nvar DragCircleMode = _objectSpread({}, MapboxDraw.modes.draw_polygon);\n\nDragCircleMode.onSetup = function (opts) {\n  var polygon = this.newFeature({\n    type: Constants.geojsonTypes.FEATURE,\n    properties: {\n      isCircle: true,\n      center: []\n    },\n    geometry: {\n      type: Constants.geojsonTypes.POLYGON,\n      coordinates: [[]]\n    }\n  });\n  this.addFeature(polygon);\n  this.clearSelectedFeatures();\n  doubleClickZoom.disable(this);\n  dragPan.disable(this);\n  this.updateUIClasses({\n    mouse: Constants.cursors.ADD\n  });\n  this.activateUIButton(Constants.types.POLYGON);\n  this.setActionableState({\n    trash: true\n  });\n  return {\n    polygon: polygon,\n    currentVertexPosition: 0\n  };\n};\n\nDragCircleMode.onMouseDown = DragCircleMode.onTouchStart = function (state, e) {\n  var currentCenter = state.polygon.properties.center;\n\n  if (currentCenter.length === 0) {\n    state.polygon.properties.center = [e.lngLat.lng, e.lngLat.lat];\n  }\n};\n\nDragCircleMode.onDrag = DragCircleMode.onMouseMove = function (state, e) {\n  var center = state.polygon.properties.center;\n\n  if (center.length > 0) {\n    var distanceInKm = distance(turfHelpers.point(center), turfHelpers.point([e.lngLat.lng, e.lngLat.lat]), {\n      units: 'kilometers'\n    });\n    var circleFeature = circle(center, distanceInKm);\n    state.polygon.incomingCoords(circleFeature.geometry.coordinates);\n    state.polygon.properties.radiusInKm = distanceInKm;\n  }\n};\n\nDragCircleMode.onMouseUp = DragCircleMode.onTouchEnd = function (state, e) {\n  dragPan.enable(this);\n  return this.changeMode(Constants.modes.SIMPLE_SELECT, {\n    featureIds: [state.polygon.id]\n  });\n};\n\nDragCircleMode.onClick = DragCircleMode.onTap = function (state, e) {\n  // don't draw the circle if its a tap or click event\n  state.polygon.properties.center = [];\n};\n\nDragCircleMode.toDisplayFeatures = function (state, geojson, display) {\n  var isActivePolygon = geojson.properties.id === state.polygon.id;\n  geojson.properties.active = isActivePolygon ? Constants.activeStates.ACTIVE : Constants.activeStates.INACTIVE;\n  return display(geojson);\n};\n\nmodule.exports = DragCircleMode;","map":null,"metadata":{},"sourceType":"script"}